# 几种常见升级方式
---

## 一. bootloader直接升级
---

- 手动重启设备(重新上电或复位)
- 启动后设备首先允许bootloader,并等待(比如10S)指令或升级文件
- 在等待时机内,通过串口等发送升级指令或升级文件
- 接收升级文件,并烧写到Flash中,并置升级成功标志
- 跳转到Flash地址执行
- 如设备未在指定时间内接收到指令或数据,直接跳转到Flash地址执行
- 如升级失败,只能人工重启,继续升级

 
---
-  ROM分区
- | bootloader | 应用程序 | 参数存储(根据需要) |
---

## 二. 外部Flash缓存
---

### 应用程序功能

- 通过任何能够获取数据的途径(串口,以太网,无线等),将接收到升级数据缓存到外部Flash中
- 置需要升级标志,并写入到参数存储区(供bootloader使用)
- 自动复位重启设备

### bootloader功能

- 设备启动,先进入bootloader区,并读取是否需要升级标志
- 如无需升级,直接跳转到程序运行区执行应用程序
- 如需要升级,将外部Flash中的升级文件,烧写到ROM区,并置升级完成标志
- 跳转到程序运行区执行应用程序

 
---
-  ROM分区
- | bootloader | 应用程序 | 参数存储 |
- | 外部Flash缓存区 | ... |
---

## 双应用程序区
---

### 应用程序功能

- 通过任何能够获取数据的途径(串口,以太网,无线等),将接收到升级数据存到另一个分区
- 置升级运行区域标志

### bootloader功能

- 设备启动,先进入bootloader区,并读取程序运行区域标志
- 跳转到程序运行区执行应用程序

---
- **ROM分区**
- | bootloader | 应用程序1 | 应用程序2 | 参数存储 |
---



# 升级注意事项

* 编译程序设置(程序运行地址等)
* 第一次烧写文件的制作(不能让生产部门太麻烦)
* bin及HEX文件的校验(尤其Bin文件的安全性)
* 升级失败的处理
* 升级协议中,最后保护设备类型,软件版本号等基本信息,方便校验